<!-- index.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Multirun Harvesting Overview</title>

    <!-- CSS -->
    <link href="/static/css/custom.css" rel="stylesheet">
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <!-- JS -->
    <script src="/static/js/angular.min.js"></script>
    <script src="/static/js/gen_mh.js"></script>

</head>
<body style="margin: 20px">


<div class="opaque">
    <div class="container" ng-app="multirunApp" ng-controller="mainController" ng-init="getData()">


        <div class="header">

            <form>
                <div class="form-group">
                    <div class="input-group">
                        <div class="input-group-addon"><i class="fa fa-search"></i></div>

                        <input type="text" class="form-control" placeholder="Search" ng-model="searchMultirun">

                    </div>
                </div>
            </form>
        </div>

        <ul class="ulflex">
            <li ng-repeat="(id, col) in columns" class="liflex">
                <label class="checkbox flexlabel">
                    <input type="checkbox" ng-model="col['show']">
                    {{col['name']}}
                </label>
            </li>
        </ul>


        <div class="multiruntab" style="overflow-x:auto">
            <table class="table table-bordered table-striped">

                <thead>
                <tr>

                    <td></td>
                    <td ng-repeat="(id, col) in columns" ng-show="col['show']">
                        <a href="#" ng-click="sortBy(id)">
                            {{ col['name'] }}
                            <span ng-show="sortPredicate == id && !sortReverse" class="fa fa-caret-down"></span>
                            <span ng-show="sortPredicate == id && sortReverse" class="fa fa-caret-up"></span>
                        </a>
                    </td>

                </tr>
                </thead>

                <tbody>
                <tr ng-repeat-start="m in multiruns | orderBy:sortPredicate:sortReverse | filter:searchMultirun"
                    ng-style="{{rowColor(m['state'])}}">
                    <td>
                        <button ng-if="m.details" ng-click="m.details = false">-</button>
                        <button ng-if="!m.details" ng-click="m.details = true">+</button>
                    </td>
                    <td ng-repeat="(id, col) in columns" ng-show="columns[id]['show']">
                        {{ m[id] }}
                    </td>
                </tr>
                <tr ng-if="m.details" ng-repeat-end>
                    <td colspan=" {{ visibleCols() }}" class="cleantd">
                        <div class="well">
                            <p>
                                ID: {{ m['id'] }}
                            </p>
                            <p>
                                Runs:
                            <ul>
                                <li ng-repeat="run in m['runs'] | orderBy:'number'">
                                    {{ run['number'] }}
                                </li>
                            </ul>
                            </p>
                            <p>
                                State: {{ m['state'] }}
                            </p>
                            <p>
                                Dataset: {{ m['dataset'] }}
                            </p>
                            <p>
                                Failure retries: {{ m['failure_retries'] }}
                            </p>
                            <p>
                                No payload retries: {{ m['no_payload_retries'] }}
                            </p>
                            <p>
                                Perform payload upload: {{ m['perform_payload_upload'] ? 'YES' : 'NO'}}
                            </p>
                            <p>
                                Number of events: {{ m['number_of_events'] }}
                            </p>
                            <p>
                                BField: {{ m['bfield'] }}
                            </p>
                            <p>
                                CMSSW: {{ m['cmssw'] }}
                            </p>
                            <p>
                                Dropbox upload log:
                                <span ng-show="m['dropbox_log'] == null">
                                      N/A
                                </span>
                                <a href="{{ m['dropbox_log'] }}">{{ m['dropbox_log'] }}</a>
                            </p>
                            <p>
                                EOS dirs:
                                <span ng-show="m['eos_dirs'].length == 0">
                                      Upload not performed
                                </span>
                                <ul>
                                    <li ng-repeat="dir in m['eos_dirs']">
                                        {{ dir }}
                                    </li>
                                </ul>
                            </p>
                            <p>
                                Global tag: {{ m['global_tag'] }}
                            </p>
                            <p>
                                SCRAM architecture: {{ m['scram_arch'] }}
                            </p>
                            <p>
                                Scenario: {{ m['scenario'] }}
                            </p>
                            <p>
                                Run class name: {{ m['run_class_name'] }}
                            </p>
                            <p>
                                Processing times:
                                <span ng-show="m['processing_times'].length == 0">
                                      Processing not started
                                </span>
                                <ul>
                                    <li ng-repeat="pt in m['processing_times']">
                                        {{ pt }}
                                    </li>
                                </ul>
                            </p>
                        </div>
                    </td>
                </tr>
                </tbody>

            </table>
        </div>


    </div>
</div>
</body>
</html>